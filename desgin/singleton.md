# Singleton Pattern

- 객체의 인스턴스가 오직 1개만 생성되는 디자인패턴.
  - 최초 생성 이후에 호출된 생성자는 최초의 생성된 객체를 리턴한다.

- 사용하는 경우
  - 인스턴스가 한 개만 존재하는 것을 보장하고 싶을 때 `singleton pattern`을 사용한다.
  - 주로 공통된 객체를 여러개 생성해서 사용해야하는 상황에 사용한다.
    - 데이터베이스 커넥션풀, 스레드풀, 캐시, 로깅

- Java는 생성자를 private으로 선언해 싱글톤을 구현하고, Kotlin은 `object`라는 싱글톤 키워드가 따로 있다. python은 `__new__` 메서드를 오버라이딩하여 보통 구현한다.



### Singleton Pattern의 장점과 단점

- 장점
  - 객체를 생성할 때마다 메모리 할당을 받을 필요가 없어 메모리 낭비를 방지할 수 있다.
  - 다른 객체끼리 데이터를 공유하는 것이 가능하다.
- 단점
  - 전역 상태를 만들 수 있다는 특성에 의해 `개방-폐쇄 원칙`에 위배될 수 있다.
    - 싱글톤 인스턴스가 많은 데이터를 공유시키면 다른 클래스 간의 결합도가 높아질 수 있고, 유지보수 및 테스트가 복잡해진다. 
  - 서버환경에서는 싱글톤이 하나만 만들어 지는 것을 보장하지 못한다. 
    - 멀티스레드 환경에서 동기화 처리를 제대로 하지 않으면 싱글톤 인스턴스가 여러 개 생성될 수 있어서 조심해야 한다. (ex - `Lazy Initialization`, `Initialization on demand holder idion`)
  - 테스트하기가 힘들다.



### 싱글톤코드는 테스트를 어렵게 만든다. 그럼에도 스프링에서 기본 규칙으로 Singleton bean을 만드는 이유

- 스프링 초당 수십~수백 번의 요청을 받아 처리할 수 있는 서버 환경에 주로 적용되기 때문에 빈 오브젝트를 모두 싱글톤으로 만든다. 
  - 클라이언트 요청이 올 때마다 오브젝트를 새로 생성한다면 많은 요청에 대한 부하를 감당할 수 없기 때문이다.
